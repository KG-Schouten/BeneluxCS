<!DOCTYPE html>
{% extends "base.html" %}

{% import "macros/filters/range_slider.html" as sliders %}
{% import "macros/filters/filter_group.html" as filter_group %}
{% import "macros/filters/select_picker.html" as select_picker %}
{% import "macros/filters/countries_filter.html" as countries_filter %}

{% block title %}Stats - BeneluxCS{% endblock %}

{% block extra_css %}
<!-- Sidebar -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/sidebar.css') }}">

<!-- Filter CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/filters/flags_filter.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/filters/range_slider.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/filters/date_filter.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/filters/filter_group.css') }}">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">

<!-- Stats CSS styles -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/stats/stats.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/stats/stats_filters.css') }}">
{% endblock %}

{% block content %}
<div class="stats-page-wrapper">

    <div class="sidebar left">
        <!-- Filters -->
        <div class="sidebar-content accordion-enabled active">
            <div class="sidebar-header">
                Country
            </div>
            <div class="sidebar-body">
                {{ countries_filter.countries_filter(['nl', 'be', 'lu']) }}
            </div>
        </div>

        <div class="sidebar-content accordion-enabled active">
            <div class="sidebar-header">
                Season
            </div>
            <div class="sidebar-body">
                {{ select_picker.select_picker_multiple("seasons", seasons) }}
            </div>
        </div>

        <div class="sidebar-content accordion-enabled active">
            <div class="sidebar-header">
                Division
            </div>
            <div class="sidebar-body">
                {{ filter_group.checkbox_filter("divisions", divisions) }}
            </div>
        </div>

        <div class="sidebar-content accordion-enabled active">
            <div class="sidebar-header">
                Stage
            </div>
            <div class="sidebar-body">
                {{ filter_group.checkbox_filter("stages", ['Regular Season', 'Playoffs']) }}
            </div>
        </div>

        <div class="sidebar-content accordion-enabled active">
            <div class="sidebar-header">
                Timestamp
            </div>
            <div class="sidebar-body">
                <div class="date_filter" id="dateFilter">
                    <i class="fa fa-calendar"></i>&nbsp;

                    <div class="date_filter_label">
                        Select date range
                    </div>

                    <div class="date_filter_dates">
                        <span class="date_filter_start">
                        </span>

                        <span class="date_filter_end">
                        </span>
                    </div>
                    <span></span>
                </div>
            </div>
        </div>

        <div class="sidebar-content accordion-enabled active">
            <div class="sidebar-header">
                Team Name
            </div>
            <div class="sidebar-body">
                <div class="team-search">
                    <i class="bi bi-search"></i>
                    <input class="search-input" type="search" id="teamNameInput" placeholder="Enter team name">
                </div>
            </div>
        </div>

        <div class="sidebar-content accordion-enabled active">
            <div class="sidebar-header">
                Matches Played
            </div>
            <div class="sidebar-body">
                {{ sliders.dual_range_slider(0, 50, 1) }}
            </div>
        </div>
    </div>

    <div class="stats-wrapper">

    </div>
</div>



{% endblock %}

{% block javascript %}
{{ super() }}
<!-- No-UI slider -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>

<!-- Bootstrap-Select -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>

<!-- Moment.js + Daterangepicker -->
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<script>
$(function() {
    var start = null;
    var end = null;

    function updateLabel(startDate, endDate) {
        if (startDate && endDate) {
            // If a range is selected, show the dates
            $('#dateFilter .date_filter_label').hide();
            $('#dateFilter .date_filter_start').html(startDate.format('DD-MM-YYYY'));
            $('#dateFilter .date_filter_end').html(endDate.format('DD-MM-YYYY'));
        } else {
            // If no selection, show placeholder text
            $('#dateFilter .date_filter_label').show();
            $('#dateFilter .date_filter_start').html('');
            $('#dateFilter .date_filter_end').html('');
        }
    }

    $('#dateFilter').daterangepicker({
        "showDropdowns": true,
        "alwaysShowCalendars": true,
        ranges: {
            'This Week': [moment().startOf('week'), moment().endOf('week')],
            'Last Week': [moment().subtract('1', 'week').startOf('week'), moment().subtract('1', 'week').endOf('week')],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')],
            'Last 3 Months': [moment().subtract(3, 'month').startOf('month'), moment().endOf('month')],
            'Last 6 Months': [moment().subtract(6, 'month').startOf('month'), moment().endOf('month')],
            'This Year': [moment().startOf('year'), moment().endOf('year')],
            'All Time': [moment('2000-01-01'), moment()],
        }
    }, updateLabel);

    // Filter hook
    $('#dateFilter').on('apply.daterangepicker', function(ev, picker) {
        start = picker.startDate;
        end = picker.endDate;

        if (picker.chosenLabel === 'All Time') {
            $('#dateFilter .date_filter_label').text('All Time').show();
            $('#dateFilter .date_filter_start').html('');
            $('#dateFilter .date_filter_end').html('');
        } else {
            $('#dateFilter .date_filter_label').hide();
            $('#dateFilter .date_filter_start').html(start.format('DD-MM-YYYY'));
            $('#dateFilter .date_filter_end').html(end.format('DD-MM-YYYY'));
        }

        // Example: send to filtering function
        // filterStats({
        //     start: picker.chosenLabel === 'All Time' ? null : start.format('YYYY-MM-DD'),
        //     end: picker.chosenLabel === 'All Time' ? null : end.format('YYYY-MM-DD')
        // });
    });
});
</script>

<!-- Stats.js -->
<script src="{{ url_for('static', filename='js/stats.js') }}"></script>
{% endblock %}