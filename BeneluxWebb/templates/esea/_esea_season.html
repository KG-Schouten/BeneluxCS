{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/table.css') }}">

<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/esea/esea_cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/esea/esea_card_details.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/esea/esea_card_details_table.css') }}">
{% endblock %}

{% block extra_js %}
{% endblock %}

{% for division_name, teams in divisions.items() %}
    <div class="division-separator">
        <h3 class="text-left">{{ division_name }}</h3>
    </div>

    {% for team in teams %}
    <div class="team-card">
        <div class="team-card-visible">
            <div class="team-card-body">
            
                <div class="team-avatar">
                    <img src="{{ url_for('static', filename='img/avatars/' ~ team.team_id ~ '_' ~ team.season_number ~ '.webp') }}"
                        alt="Team Avatar"
                        data-placeholder="{{ url_for('static', filename='img/faceit/team_avatar_placeholder.jpg') }}"
                        onerror="this.onerror=null;this.src=this.dataset.placeholder;">
                </div>
                
                <div class="team-card-name">
                    <a class="team-link"
                        href="https://www.faceit.com/en/teams/{{ team.team_id }}/leagues"
                        target="_blank"
                        onclick="plausible('Team Link Clicked', { props: { 
                            location: 'Team Card',
                            team: '{{ team.team_name }}', 
                            season: '{{ team.season_number }}', 
                            division: '{{ division_name }}' } })">
                            {{ team.team_name }}
                    </a>
                </div>

                <div class="main-players-box">
                    {% for player in team.players_main %}
                    <a href="https://www.faceit.com/en/players/{{player.player_name}}"
                        class="text-decoration-none text-reset"
                        target="_blank"
                        onclick="plausible('Player Profile Clicked', { props: { 
                            location: 'Team Card',
                            player: '{{ player.player_name }}', 
                            team: '{{ team.team_name }}', 
                            season: '{{ team.season_number }}', 
                            division: '{{ division_name }}'} })">

                        <div class="main-player">
                            <div class="main-player-avatar">
                                <img class="{{ 'highlight-border' if player.player_country|lower in ['nl', 'be', 'lu'] else ''}}" 
                                    src="{{ player.player_avatar }}"
                                    alt="{{ player.player_name }}"
                                    data-placeholder="{{ url_for('static', filename='img/faceit/player_avatar_placeholder.jpg') }}"
                                    onerror="this.onerror=null;this.src=this.dataset.placeholder;">
                            </div>
                            <div class="main-player-name {{ 'highlight-text' if player.player_country|lower in ['nl', 'be', 'lu'] else ''}}">
                                <strong>{{ player.player_name }}</strong>
                                <img src="{{ url_for('static', filename='img/flags/' ~ player.player_country|lower ~ '.png') }}"
                                    alt="{{ player.player_country }}">
                            </div>
                        </div>
                    </a>
                    {% endfor%}
                </div>

                <div class="sub-players-box">
                    {% if team.players_sub %}
                        {% for player in team.players_sub %}
                        <a href="https://www.faceit.com/en/players/{{ player.player_name }}" class="text-decoration-none text-reset" target="_blank">
                            <div class="sub-player">
                                <img src="{{ url_for('static', filename='img/flags/' ~ player.player_country|lower ~ '.png') }}"
                                    alt="{{ player.player_country|lower }}">
                                <span class="{{ 'highlight-text' if player.player_country|lower in ['nl', 'be', 'lu'] else ''}}">{{ player.player_name }}</span>
                            </div>
                        </a>
                        {% endfor %}
                    {% endif %}
                    {% if team.players_coach %}
                        {% for coach in team.players_coach %}
                        <a href="https://www.faceit.com/en/players/{{ coach.player_name }}" class="text-decoration-none text-reset" target="_blank">
                            <div class="sub-player">
                                <img src="{{ url_for('static', filename='img/flags/' ~ coach.player_country|lower ~ '.png') }}"
                                    alt="{{ coach.player_country }}">
                                <span class="text-muted">{{ coach.player_name }} <em>(C)</em></span>
                            </div>
                        </a>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="score-boxes">
                    {% for stage in team.stages %}
                        <div class="stage-box" 
                            data-bs-toggle="tooltip" 
                            title="Placement: {{ stage.placement['left'] }}{% if stage.placement.get('right') is not none %} - {{ stage.placement['right'] }}{% endif %}">
                            
                            <div class="stage-logo">
                                <img 
                                    src="{{ url_for('static', filename='img/esea/' ~ ('regularSeason.png' if 'regular' in stage.stage_name|lower else 'playoffs.png')) }}"
                                    alt="ESEA Stage Logo">
                            </div>
                            <div class="stage-score">
                                <span style="color: #28a745;">
                                    {{ stage.wins or 0 }}
                                </span>
                                -
                                <span style="color: #dc3545;">
                                    {{ stage.losses or 0 }}
                                </span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <div class="details-btn"
                    data-team-id="{{ team.team_id }}" data-season-number="{{ team.season_number }}" data-division-name="{{ division_name }}"
                    onclick="plausible('Team Details Toggled', { props: { 
                        location: 'Team Card',
                        team: '{{ team.team_name }}', 
                        season: '{{ team.season_number }}',
                        division: '{{ division_name }}' } })">
                    
                    <i class="bi bi-chevron-down"></i>
                </div>
            </div>
        </div>
        
        <!-- Collapsible section for team details -->
        <div id="collapseTeam-{{team.team_id}}-{{team.season_number}}">
            <div class="collapse-body" data-team-id="{{ team.team_id }}" data-season-number="{{ team.season_number }}" data-team-name="{{ team.team_name }}">
                
            </div>
        </div>
    </div>
    {% endfor %}
{% endfor %}

<script>

</script>