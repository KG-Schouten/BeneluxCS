{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/match_box.css') }}">
{% endblock %}

{% from "macros/match_box.html" import match_box %}

{% if benelux_matches %}
<div class="sidebar-content">
  <div class="sidebar-header">
    <span> Benelux Clashes </span>
  </div>
  <div class="sidebar-body" id="benelux-matches">
    {% for match in benelux_matches %}
      {% if match.match_time < end_of_day %}
        {{ match_box(match.division_name, match, today=true) }}
      {% else %}
        {{ match_box(match.division_name, match, today=false) }}
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endif %}

<div class="sidebar-content">
  <div class="sidebar-header">
    <span> Today's Matches </span>
  </div>
  <div class="sidebar-body" id="todays-matches">
    {% if todays_matches %}
      {% for match in todays_matches %}
        {{ match_box(match.division_name, match) }}
      {% endfor %}
    {% else %}
      <div class="text-muted"> No matches scheduled for today. </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    function refreshMatches() {
      console.log('Refreshing matches...');
      fetch('/esea/matches')
        .then(response => response.text())
        .then(html => {
            document.getElementById('matches-sidebar').innerHTML = html;
        })
        .catch(err => console.error('Error fetching matches:', err));
    }

    socket.on('match_update', (data) => {
      console.log('Received match update:', data);
      // Call your refresh function
      refreshMatches();
    });

    // Initial load
    refreshMatches();

  });
</script>
